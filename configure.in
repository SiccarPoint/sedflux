AC_PREREQ([2.59])

AC_INIT([ew],[2.0],[huttone@colorado.edu])
AC_CONFIG_HEADERS(config.h:config-h.in)
AC_CONFIG_AUX_DIR([config])
AC_CONFIG_MACRO_DIR([m4])

AM_INIT_AUTOMAKE([1.9.6 foreign])

m4_define([glib_required_version],[2.12.0])
m4_define([gtk_required_version],[2.2.0])
m4_define([check_required_version],[0.9.4])

PKG_PROG_PKG_CONFIG([0.20])

PKG_CHECK_MODULES(GLIB,[glib-2.0 >= glib_required_version])

DOXYGEN_VERSION="(none)"
CHECK_VERSION="(null)"
GTK_VERSION="NULL"

if test x$with_libcheck != xno ; then
   PKG_CHECK_MODULES(CHECK,[check >= check_required_version],
      CHECK_VERSION=`$PKG_CONFIG --modversion check`,
      AC_MSG_ERROR([
*** Checks for check failed.  You can build without it by passing
*** --without-libcheck to configure but some programs using GTK+ will
*** not work properly.]) )
fi

if test x$with_libgtk != xno ; then
   PKG_CHECK_MODULES(GTK,[gtk+-2.0 >= gtk_required_version],
      GTK_VERSION=`$PKG_CONFIG --modversion gtk+-2.0`,
      AC_MSG_ERROR([
*** Checks for GTK+-2.0 failed.  You can build without it by passing
*** --without-libgtk to configure but some programs using GTK+ will
*** not work properly.]) )
fi

if test x$with_doxygen != xno ; then
   AC_CHECK_PROGS(DOXYGEN, doxygen )

   if test x$DOXYGEN != x ; then
      DOXYGEN_VERSION=`$DOXYGEN --version`
   fi
fi

AC_PROG_CC
AC_PROG_CC_STDC
AC_PROG_LIBTOOL

AC_HEADER_STDC

AC_C_CONST
AC_TYPE_PID_T
AC_TYPE_SIZE_T

AM_CONDITIONAL(HAVE_DOXYGEN, test x$DOXYGEN != x )
AM_CONDITIONAL(HAVE_GTK, test x$GTK != x )
AM_CONDITIONAL(HAVE_CHECK, test x$CHECK != x )

#LIB_UTILS_CFLAGS="-I${includedir}"
LIB_UTILS_CFLAGS="-I$$top_srcdir/libutils/src"
LIB_SED_CFLAGS="-I$$top_srcdir/libsed/src"

cflags_set="$CFLAGS"

#GLIB_ADD_TO_VAR(CFLAGS, -I${prefix}/include , -I${prefix}/include )
GLIB_ADD_TO_VAR(CFLAGS, ${GLIB_CFLAGS} , ${GLIB_CFLAGS} )
#GLIB_ADD_TO_VAR(CFLAGS, -I${top_srcdir}/libutils/src , -I${top_srcdir}/libutils/src )
#GLIB_ADD_TO_VAR(CFLAGS, -I${top_srcdir}/libsed/src , -I${top_srcdir}/libsed/src )
#GLIB_ADD_TO_VAR(LIBS, -L${prefix}/lib     , -L${prefix}/lib )

#GLIB_ADD_TO_VAR(LIBS, -L${top_builddir}/libutils/src , -L${top_builddir}/libutils/src )
#GLIB_ADD_TO_VAR(LIBS, -L${top_builddir}/libsed/src   , -L${top_builddir}/libsed/src )
GLIB_ADD_TO_VAR(LIBS, -lm , -lm )

AM_PATH_GLIB_2_0( glib_required_version , :,
   AC_MSG_ERROR([
*** GLIB glib_required_version or better is required. The latest version of
*** GLIB is always available from ftp://ftp.gtk.org/pub/gtk/.]),
  gobject gmodule-no-export gthread)

AC_SUBST( LIB_UTILS_CFLAGS )
AC_SUBST( LIB_SED_CFLAGS )
AC_SUBST( GLIB_LIBS )
AC_SUBST( GLIB_CFLAGS )
AC_SUBST( GTK_LIBS )
AC_SUBST( GTK_CFLAGS )
AC_SUBST( CHECK_LIBS )
AC_SUBST( CHECK_CFLAGS )

AC_CONFIG_FILES([ libutils/src/utils.pc ])
AC_CONFIG_FILES([ libsed/src/sedflux.pc ])

AC_CONFIG_FILES([Makefile \
           libutils/Makefile libutils/src/Makefile \
           libsed/Makefile libsed/src/Makefile libsed/share/Makefile \
           avulsion/Makefile avulsion/src/Makefile \
           bing/Makefile bing/src/Makefile \
           compact/Makefile compact/src/Makefile compact/data/Makefile \
           diffusion/Makefile diffusion/src/Makefile diffusion/data/Makefile \
           failure/Makefile failure/src/Makefile \
           flow/Makefile flow/src/Makefile flow/mfiles/Makefile \
           inflow/Makefile inflow/src/Makefile inflow/data/Makefile inflow/mfiles/Makefile \
           muds/Makefile muds/src/Makefile muds/data/Makefile \
           plume/Makefile plume/src/Makefile plume/demo/Makefile plume/mfiles/Makefile \
           quake/Makefile quake/src/Makefile \
           sakura/Makefile sakura/src/Makefile sakura/mfiles/Makefile sakura/data/Makefile \
           squall/Makefile squall/src/Makefile squall/data/Makefile \
           subside/Makefile subside/src/Makefile \
           xshore/Makefile xshore/src/Makefile \
           sedflux/Makefile sedflux/src/Makefile sedflux/data/Makefile sedflux/mfiles/Makefile \
           hydrotrend/Makefile hydrotrend/src/Makefile \
              hydrotrend/data/Makefile hydrotrend/mfiles/Makefile \
           sedutils/Makefile sedutils/src/Makefile \
           inflow/src/runinflow \
           sakura/src/runsakura \
           sedflux/src/runsedflux \
           sedflux/src/runsedflux-batch \
           docs/sedflux-doxyfile \
           docs/Makefile])

AC_OUTPUT

echo \
"------------------------------------------------------------------------
Configuration:

  Source code location:       ${srcdir}
  Compiler:                   ${CC}
  Compiler flags:             ${cflags_set}
  Host System Type:           ${host}
  Install path:               ${prefix}
  With gtk+-2.0:              ${GTK_VERSION}
  With check:                 ${CHECK_VERSION}
  With doxygen:               ${DOXYGEN_VERSION}

  See config.h for further configuration information.
------------------------------------------------------------------------"

